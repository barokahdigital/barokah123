<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sapa Warga RT04</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <link rel="stylesheet" href="style.css">

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>
      <section id="loginPage" style="min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem;">
    <div class="card p-4" style="max-width:640px;width:100%;">
      <div class="text-center mb-3">
        <img id="logoLogin" src="Screenshot 2025-08-30 100250.png" alt="Logo" style="width:96px;height:96px;border-radius:12px;object-fit:cover">
        <h4 class="mt-2">SAPA KELUARGA RT04</h4>
        <p class="text-muted mb-0">Selamat Datang di Situs Sapa Keluarga RT 04</p>
      </div>
      <div class="mb-2"><input id="username" class="form-control" placeholder="Username"></div>
      <div class="mb-2"><input id="password" type="password" class="form-control" placeholder="Password"></div>
      <div class="d-grid gap-2">
        <button class="btn btn-primary" onclick="login()">Login</button>
      </div>
      <small class="d-block text-muted mt-3">Copyright: <b>@2025BarokahDigitalMedia</b></small>
    </div>
  </section>

<section id="app" class="hidden">
  <header>
    <div class="brand">
      <img id="logoMain" src="Screenshot 2025-08-30 100250.png" alt="Logo" style="width:56px;height:56px;border-radius:10px;object-fit:cover">
      <div>
        <div style="font-weight:700">SAPA KELUARGA RT04</div>
        <div style="font-size:.85rem;opacity:.9">Dashboard Laporan Keuangan dan Data Warga</div>
      </div>
    </div>
    <div class="d-flex align-items-center gap-2">
      <div id="dateTime" style="font-weight:600;margin-right:8px"></div>
      <button class="btn btn-light btn-sm me-1" onclick="openReadme()">README</button>
      <button class="btn btn-danger btn-sm" onclick="logout()">Sign Out</button>
    </div>
  </header>

  <div class="container py-3">
    <ul class="nav nav-tabs" id="tabs">
      <li class="nav-item"><a class="nav-link active" data-target="dashboard">Dashboard</a></li>
      <li class="nav-item"><a class="nav-link" data-target="data">Data Warga</a></li>
      <li class="nav-item"><a class="nav-link" data-target="keuangan">Keuangan</a></li>
      <li class="nav-item adminOnly"><a class="nav-link" data-target="admin">Admin</a></li>
    </ul>

    <div id="dashboard" class="mt-3">
      <div class="card-rounded p-3 mb-3 demografi">
        <h5>Demografi Warga Kita</h5>
        <div class="d-flex desktop-split gap-3" style="align-items:stretch">
          <div style="flex:1">
            <div class="row g-3">
              <div class="col-md-3">
                <div class="stat-card" style="background:linear-gradient(180deg,var(--accent1),#60a5fa);color:#fff;">
                  <div class="small">Total Warga</div>
                  <div id="s_total" class="h4">0</div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card" style="background:linear-gradient(180deg,var(--accent2),#a78bfa);color:#fff;">
                  <div class="small">Laki-laki</div>
                  <div id="s_laki" class="h4">0</div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card" style="background:linear-gradient(180deg,var(--accent3),#fbbf24);color:#000;">
                  <div class="small">Perempuan</div>
                  <div id="s_perempuan" class="h4">0</div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card" style="background:linear-gradient(180deg,var(--accent4),#34d399);color:#fff;">
                  <div class="small">Jenis Pekerjaan</div>
                  <div id="s_pekerjaan" class="h5">0</div>
                </div>
              </div>
            </div>

            <div class="row g-3 mt-3">
              <div class="col-md-4">
                <div class="stat-card"><div class="small text-muted">Anak (&lt;18)</div><div id="s_anak" class="h5">0</div></div>
              </div>
              <div class="col-md-4">
                <div class="stat-card"><div class="small text-muted">Dewasa (18-59)</div><div id="s_dewasa" class="h5">0</div></div>
              </div>
              <div class="col-md-4">
                <div class="stat-card"><div class="small text-muted">Lansia (>=60)</div><div id="s_lansia" class="h5">0</div></div>
              </div>
            </div>
          </div>

          <div style="flex:1">
            <div class="card-rounded p-3 h-100">
              <h6>Grafik Demografi</h6>
              <canvas id="chartDemografi" style="max-height:320px"></canvas>
              <div class="mt-2 small text-muted">Persentase Warga RT 04 Berdasarkan Category.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card-rounded p-3 keuangan">
        <h5>Laporan Keuangan Kita</h5>
        <div class="d-flex desktop-split gap-3" style="align-items:stretch">
          <div style="flex:1">
            <div class="card-rounded p-3 h-100">
              <h6>Grafik Kas per Kategori</h6>
              <canvas id="chartKeuangan" style="max-height:320px"></canvas>
              <div class="mt-2 small text-muted">Perbandingan kas: Insiba / Ronda / Donasi / Umum.</div>
            </div>
          </div>

          <div style="flex:1">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="stat-card" style="background:linear-gradient(180deg,var(--k1),#34d399);color:#fff;">
                  <div class="small">Total Pemasukan</div>
                  <div id="k_total_in" class="h5">Rp0</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="stat-card" style="background:linear-gradient(180deg,var(--k2),#fb7185);color:#fff;">
                  <div class="small">Total Pengeluaran</div>
                  <div id="k_total_out" class="h5">Rp0</div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="stat-card" style="background:linear-gradient(180deg,#155e75,#2dd4bf);color:#fff;">
                  <div class="small">Kas Insiba</div>
                  <div id="k_insiba" class="h5">Rp0</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="stat-card" style="background:linear-gradient(180deg,#7c2d12,#fb923c);color:#fff;">
                  <div class="small">Kas Ronda</div>
                  <div id="k_ronda" class="h5">Rp0</div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="stat-card" style="background:linear-gradient(180deg,#065f46,#34d399);color:#fff;">
                  <div class="small">Donasi</div>
                  <div id="k_donasi" class="h5">Rp0</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="stat-card" style="background:linear-gradient(180deg,#0ea5e9,#60a5fa);color:#fff;">
                  <div class="small">Kas Umum</div>
                  <div id="k_umum" class="h5">Rp0</div>
                </div>
              </div>

              <div class="col-12">
                <div class="small text-muted">Catatan: Scorecard menunjukkan saldo akhir per kas.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="data" class="mt-3 hidden">
      <div class="card-rounded p-3">
        <div class="d-flex justify-content-between align-items-center">
          <h5>Data Warga</h5>
          <div class="d-flex gap-2 align-items-center">
            <input id="searchWarga" class="form-control" style="width:240px" placeholder="Cari...">
            <button class="btn btn-outline-primary" onclick="exportCSV('tableWarga')">Export CSV</button>
            <button class="btn btn-outline-danger" onclick="exportTablePrint('tableWarga','Data Warga')">Print</button>
          </div>
        </div>

        <div class="table-responsive mt-3">
          <table id="tableWarga" class="table table-bordered align-middle">
            <thead>
              <tr><th>NIK</th><th>Nama</th><th>TTL (Tgl Lahir)</th><th>Usia</th><th>RT</th><th>RW</th><th>JK</th><th>Jenis Pekerjaan</th><th>Penghasilan</th><th>Aksi</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="keuangan" class="mt-3 hidden">
      <div class="card-rounded p-3">
        <div class="d-flex justify-content-between align-items-center">
          <h5>Data Keuangan</h5>
          <div class="d-flex gap-2 align-items-center">
            <input id="searchKeu" class="form-control" style="width:200px" placeholder="Cari...">
            <select id="filterKategori" class="form-select" style="width:160px"><option value="">Semua Kategori</option><option value="Insiba">Insiba</option><option value="Ronda">Ronda</option><option value="Donasi">Donasi</option><option value="Umum">Umum</option></select>
            <button class="btn btn-outline-primary" onclick="exportCSV('tableKeuangan')">Export CSV</button>
            <button class="btn btn-outline-danger" onclick="exportTablePrint('tableKeuangan','Data Keuangan')">Print</button>
          </div>
        </div>
        <div class="table-responsive mt-3">
          <table id="tableKeuangan" class="table table-bordered">
            <thead><tr><th>Tanggal</th><th>Keterangan</th><th>Kategori</th><th>Pemasukan</th><th>Pengeluaran</th><th>Saldo (Running)</th><th>Aksi</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="admin" class="mt-3 hidden">
      <div class="row g-3">
        <div class="col-md-4">
          <div class="card-rounded p-3">
            <h6>Upload Logo</h6>
            <input type="file" accept="image/*" id="logoUpload" class="form-control" onchange="handleLogoUpload(event)">
            <div class="small text-muted mt-2">Logo akan disimpan di browser dan dipakai pada header & login.</div>
          </div>
        </div>

        <div class="col-md-8">
          <div class="card-rounded p-3">
            <h6>Tambah / Edit Data Warga</h6>
            <div class="row g-2">
              <div class="col-md-3"><input id="fNIK" class="form-control" placeholder="NIK"></div>
              <div class="col-md-3"><input id="fNama" class="form-control" placeholder="Nama"></div>
              <div class="col-md-3"><input id="fTglLahir" type="date" class="form-control" placeholder="Tgl Lahir"></div>
              <div class="col-md-3"><select id="fJK" class="form-select"><option value="">JK</option><option value="L">L</option><option value="P">P</option></select></div>

              <div class="col-md-3"><input id="fRT" class="form-control" placeholder="RT"></div>
              <div class="col-md-3"><input id="fRW" class="form-control" placeholder="RW"></div>
              <div class="col-md-3"><input id="fJob" class="form-control" placeholder="Pekerjaan"></div>
              <div class="col-md-3"><input id="fPenghasilan" type="number" class="form-control" placeholder="Penghasilan (Rp)"></div>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button id="btnSaveWarga" class="btn btn-success" onclick="saveWargaFromAdmin()">Simpan Warga</button>
              <button class="btn btn-outline-secondary" onclick="resetWargaForm()">Reset</button>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="card-rounded p-3">
            <h6>Tambah / Edit Data Keuangan</h6>
            <div class="row g-2">
              <div class="col-md-2"><input id="fTgl" type="date" class="form-control"></div>
              <div class="col-md-5"><input id="fKet" class="form-control" placeholder="Keterangan"></div>
              <div class="col-md-2"><select id="fKategori" class="form-select"><option value="Umum">Umum</option><option value="Insiba">Insiba</option><option value="Ronda">Ronda</option><option value="Donasi">Donasi</option></select></div>
              <div class="col-md-1"><input id="fMasuk" type="number" class="form-control" placeholder="Masuk"></div>
              <div class="col-md-1"><input id="fKeluar" type="number" class="form-control" placeholder="Keluar"></div>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button id="btnSaveKeu" class="btn btn-success" onclick="saveKeuFromAdmin()">Simpan Keuangan</button>
              <button class="btn btn-outline-secondary" onclick="resetKeuForm()">Reset</button>
            </div>

            <div class="card-rounded p-3 mt-3">
              <h6>Saldo Awal Per Kas (Setting)</h6>
              <div class="row g-2 align-items-end">
                <div class="col-md-3"><label class="form-label small">Insiba</label><input id="bInsiba" type="number" class="form-control" placeholder="Saldo awal Insiba (Rp)"></div>
                <div class="col-md-3"><label class="form-label small">Ronda</label><input id="bRonda" type="number" class="form-control" placeholder="Saldo awal Ronda (Rp)"></div>
                <div class="col-md-3"><label class="form-label small">Donasi</label><input id="bDonasi" type="number" class="form-control" placeholder="Saldo awal Donasi (Rp)"></div>
                <div class="col-md-3"><label class="form-label small">Umum</label><input id="bUmum" type="number" class="form-control" placeholder="Saldo awal Umum (Rp)"></div>
                <div class="col-12 mt-2"><button class="btn btn-primary" onclick="saveInitialBalances()">Simpan Saldo Awal</button></div>
              </div>
              <div class="mt-2 small text-muted">Saldo awal akan ditambahkan saat menghitung saldo akhir tiap kas.</div>
            </div>

          </div>
        </div>

      </div>
    </div>

  </div></section>

    <div class="modal fade" id="modalReadme" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">README</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <ul>
            <li>Login admin/admin123 untuk akses penuh, user/user123 untuk read-only.</li>
            <li>Unggah logo di tab Admin (disimpan di localStorage).</li>
            <li>Dashboard terbagi: Demografi (atas) & Laporan Keuangan (bawah), sekarang dengan saldo per kas (Insiba,Ronda,Donasi,Umum).</li>
            <li>Pada tab Admin Anda dapat mengatur saldo awal per kas, lalu tambah transaksi dengan kategori.</li>
          </ul>
        </div>
        <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button></div>
      </div>
    </div>
  </div>

    <script src="script.js"></script>
</body>
</html>
